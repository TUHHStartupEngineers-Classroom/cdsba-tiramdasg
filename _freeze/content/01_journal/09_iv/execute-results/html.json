{
  "hash": "43052903d07d4d425ebd06973af9f124",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Geethika Tiramdas\"\nsubtitle: \"Assignment solutions\"\ntoc: true\nnumber-sections: false\n---\n\n\n## Part 1\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_ed7c012051f2a27f505db7c6dc63b85d'}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggrepel)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: ggplot2\n```\n:::\n\n```{.r .cell-code}\ndf <- readRDS(\"../../Causal_Data_Science_Data/rand_enc.rds\")\n\n# Part 1\niv_expl <- dagify(\n  Y ~ D,\n  Y ~ U,\n  D ~ U,\n  D ~ Z,\n  exposure = \"D\",\n  latent = \"U\",\n  outcome = \"Y\",\n  coords = list(x = c(U = 1, D = 0, Y = 2, Z = -1),\n                y = c(U = 1, D = 0, Y = 0, Z = 0)),\n  labels = c(\"D\" = \"Used New Features\",\n             \"Y\" = \"Time Spent\",\n             \"U\" = \"Unobserved Characteristics\",\n             \"Z\" = \"Random Encouragement\")\n)\n\n# Plot the DAG\nggdag(iv_expl, text = TRUE) +\n  geom_dag_point(color = \"lightblue\") +\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"white\") +\n  geom_dag_label_repel(aes(label = label)) +\n  theme(panel.background = element_rect(fill = \"black\"))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n## Part 2\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_8e0d4a22a2f3aaef6832d5f70692d092'}\n\n```{.r .cell-code}\n# Part 2\nmodel_biased <- lm(time_spent ~ used_ftr, data = df)\nsummary(model_biased)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Part 3\n\n* random encouragement is correlated with the `used_ftr` (positive correlation)\n* random encouragement is not directly correlated with the `time_spent` which can be seen by correlation between `used_ftr` and `time_spent` and correlation between `rand_enc` and `time_spent`. Therefore IV estimation can be used.\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_c06f94fb0147bf97ce0f62de801739e5'}\n\n```{.r .cell-code}\ncor(df) %>% round(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>            rand_enc used_ftr time_spent\n#> rand_enc       1.00     0.20       0.13\n#> used_ftr       0.20     1.00       0.71\n#> time_spent     0.13     0.71       1.00\n```\n:::\n:::\n\n\n## Part 4\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_5979d71f9a6790a96a969347cde4b6d5'}\n\n```{.r .cell-code}\nlibrary(estimatr)\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = df)\nsummary(model_iv)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = df)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}